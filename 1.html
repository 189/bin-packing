<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
    html, body, div, ul, li {margin: 0; padding: 0; } 
    li {list-style: none; }
    .wrap {width: 300px; height: 300px; border: 2px solid #000; }
    .wrap li {padding: 3px; text-align: center; float: left; border: 1px solid #ccc; margin: 3px; }
    #bigbox {position: relative; } 
    #bigbox div {position: absolute; border: 1px solid #333; }
    </style>
</head>

<body>
    <ul class="wrap">
        <li>11111</li>
        <li>33</li>
        <li>44444444444444444444</li>
        <li>5555</li>
        <li>6666</li>
        <li>7777</li>
        <li>888888888</li>
        <li>999999999999</li>
        <li>1010101</li>
        <li>aaaaa</li>
        <li>bb</li>
    </ul>

    <div id="bigbox">

    </div>
    <script>
    Packer = function(w, h) {
        this.init(w, h);
    };

    Packer.prototype = {

        init: function(w, h) {
            this.root = {
                x: 0,
                y: 0,
                w: w,
                h: h
            };
        },

        fit: function(blocks) {
            var n, node, block;
            for (n = 0; n < blocks.length; n++) {
                block = blocks[n];
                if (node = this.findNode(this.root, block.w, block.h)){
                    block.fit = this.splitNode(node, block.w, block.h);
                }
            }
        },

        findNode: function(root, w, h) {
            if (root.used){
                return this.findNode(root.right, w, h) || this.findNode(root.down, w, h);
            }
            else if ((w <= root.w) && (h <= root.h)){
                return root;
            }
            else{
                return null;
            }
        },

        splitNode: function(node, w, h) {
            node.used = true;
            node.down = {
                x: node.x,
                y: node.y + h,
                w: node.w,
                h: node.h - h
            };
            node.right = {
                x: node.x + w,
                y: node.y,
                w: node.w - w,
                h: h
            };
            return node;
        }
    };

    GrowingPacker = function() {};
    GrowingPacker.prototype = {
        fit: function(blocks) {
            var n, node, block, len = blocks.length;
            var w = len > 0 ? blocks[0].w : 0;
            var h = len > 0 ? blocks[0].h : 0;
            this.root = {
                x: 0,
                y: 0,
                w: w,
                h: h
            };
            for (n = 0; n < len; n++) {
                block = blocks[n];
                if (node = this.findNode(this.root, block.w, block.h)){
                    block.fit = this.splitNode(node, block.w, block.h);
                }
                else{
                    block.fit = this.growNode(block.w, block.h);
                }
            }
        },

        findNode: function(root, w, h) {
            if (root.used){
                return this.findNode(root.right, w, h) || this.findNode(root.down, w, h);
            }
            else if ((w <= root.w) && (h <= root.h)){
                return root;
            }
            else{
                return null;
            }
        },

        splitNode: function(node, w, h) {
            node.used = true;
            node.down = {
                x: node.x,
                y: node.y + h,
                w: node.w,
                h: node.h - h
            };
            node.right = {
                x: node.x + w,
                y: node.y,
                w: node.w - w,
                h: h
            };
            return node;
        },

        growNode: function(w, h) {
            var canGrowDown = (w <= this.root.w);
            var canGrowRight = (h <= this.root.h);

            var shouldGrowRight = canGrowRight && (this.root.h >= (this.root.w + w)); // attempt to keep square-ish by growing right when height is much greater than width
            var shouldGrowDown = canGrowDown && (this.root.w >= (this.root.h + h)); // attempt to keep square-ish by growing down  when width  is much greater than height

            if (shouldGrowRight){
                return this.growRight(w, h);
            }
            else if (shouldGrowDown){
                return this.growDown(w, h);
            }
            else if (canGrowRight){
                return this.growRight(w, h);
            }
            else if (canGrowDown){
                return this.growDown(w, h);
            }
            else{
                return null; // need to ensure sensible root starting size to avoid this happening
            }
        },

        growRight: function(w, h) {
            this.root = {
                used: true,
                x: 0,
                y: 0,
                w: this.root.w + w,
                h: this.root.h,
                down: this.root,
                right: {
                    x: this.root.w,
                    y: 0,
                    w: w,
                    h: this.root.h
                }
            };
            if (node = this.findNode(this.root, w, h)){
                return this.splitNode(node, w, h);
            }
            else{
                return null;
            }
        },

        growDown: function(w, h) {
            this.root = {
                used: true,
                x: 0,
                y: 0,
                w: this.root.w,
                h: this.root.h + h,
                down: {
                    x: 0,
                    y: this.root.h,
                    w: this.root.w,
                    h: h
                },
                right: this.root
            };
            if (node = this.findNode(this.root, w, h)){
                return this.splitNode(node, w, h);
            }
            else{
                return null;
            }
        }

    }

    function draw(x, y, w, h) {
        var box = document.getElementById('bigbox'),
            a = document.createElement('div');
        a.className = 'box';
        a.style.cssText = "width:" + w + 'px;height:' + h + 'px;top:' + y + 'px;left:' + x + 'px;';
        box.appendChild(a);
    }

    var sort = {
        random: function(a, b) {
            return Math.random() - 0.5;
        },
        w: function(a, b) {
            return b.w - a.w;
        },
        h: function(a, b) {
            return b.h - a.h;
        },
        a: function(a, b) {
            return b.area - a.area;
        },
        max: function(a, b) {
            return Math.max(b.w, b.h) - Math.max(a.w, a.h);
        },
        min: function(a, b) {
            return Math.min(b.w, b.h) - Math.min(a.w, a.h);
        },

        height: function(a, b) {
            return sort.msort(a, b, ['h', 'w']);
        },
        width: function(a, b) {
            return sort.msort(a, b, ['w', 'h']);
        },
        area: function(a, b) {
            return sort.msort(a, b, ['a', 'h', 'w']);
        },
        maxside: function(a, b) {
            return sort.msort(a, b, ['max', 'min', 'h', 'w']);
        },

        msort: function(a, b, criteria) {
            var diff, n;
            for (n = 0; n < criteria.length; n++) {
                diff = sort[criteria[n]](a, b);
                if (diff != 0)
                    return diff;
            }
            return 0;
        }
    };

    var blocks = [
    	{
            w: 60,
            h: 25
        }, {
            w: 100,
            h: 25
        }, {
            w: 30,
            h: 25
        }, {
            w: 50,
            h: 25
        }, {
            w: 50,
            h: 25
        }, {
            w: 60,
            h: 25
        }, {
            w: 150,
            h: 25
        }, {
            w: 50,
            h: 25
        },
        {
            w: 90,
            h: 25
        }, {
            w: 110,
            h: 25
        }, {
            w: 100,
            h: 25
        }, {
            w: 30,
            h: 25
        }, {
            w: 50,
            h: 25
        }, {
            w: 50,
            h: 25
        }, {
            w: 60,
            h: 25
        }, {
            w: 150,
            h: 25
        }, {
            w: 50,
            h: 25
        }, {
            w: 60,
            h: 25
        }, {
            w: 90,
            h: 25
        }, {
            w: 110,
            h: 25
        }
    ];


    var packer = new Packer(500, 500);
    // var packer = new GrowingPacker();
    blocks.sort(sort["width"]);
    packer.fit(blocks);

    for (var n = 0; n < blocks.length; n++) {
        var block = blocks[n];
        if (block.fit) {
            draw(block.fit.x, block.fit.y, block.w, block.h);
        }
    }
    </script>

</body>

</html>
