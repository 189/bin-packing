<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
    html, body, div, ul, li, a {margin: 0; padding: 0; } 
    li {list-style: none; }
    .wrap {width: 300px;  border: 1px solid #000; display: inline-block; position: relative; }
    .wrap ul { overflow: hidden; width: 300px; height: 300px; } 
    .wrap li {padding: 3px; text-align: center; float: left; border: 1px solid #ccc; margin: 2px; }
    .sample li { margin-right: 5px; margin-right: 5px; }
    a { text-decoration: none; color: #666; }
    </style>
</head>

<body>
	<div class="wrap sample" >
		<ul>
		    <li><a href="javascript:;">aaaaa</a></li>
		    <li><a href="javascript:;">bbbbb</a></li>
		    <li><a href="javascript:;">ccc</a></li>
		    <li><a href="javascript:;">ddddd</a></li>
		    <li><a href="javascript:;">eeeeeeeee</a></li>
		    <li><a href="javascript:;">ff</a></li>
		    <li><a href="javascript:;">g</a></li>
		    <li><a href="javascript:;">hhhhhh</a></li>
		    <li><a href="javascript:;">iiiiiii</a></li>
		    <li><a href="javascript:;">aaaaa</a></li>
		    <li><a href="javascript:;">bb</a></li>
		    <li><a href="javascript:;">cccccc</a></li>
		</ul>
		<p>排列前</p>
	</div>

	<div class="wrap" id="box" >
		<ul>
		    <li><a href="javascript:;">aaaaa</a></li>
		    <li><a href="javascript:;">2222</a></li>
		    <li><a href="javascript:;">3333</a></li>
		    <li><a href="javascript:;">4444444</a></li>
		    <li><a href="javascript:;">5555</a></li>
		    <li><a href="javascript:;">6666</a></li>
		    <li><a href="javascript:;">7</a></li>
		    <li><a href="javascript:;">888888888</a></li>
		    <li><a href="javascript:;">999999999999</a></li>
		    <li><a href="javascript:;">aaaaa</a></li>
		    <li><a href="javascript:;">bb</a></li>
		    <li><a href="javascript:;">cccccc</a></li>
		</ul>
		<p>排列后</p>
	</div>
    <script>
    Packer = function(w, h, mt, mr) {
    	this.mt = mt || 0;
    	this.mr = mr || 0;
        this.init(w, h);
    };

    Packer.prototype = {
        init: function(w, h) {
            this.root = {
                x: 0,
                y: 0,
                w: w,
                h: h
            };
        },

        fit: function(blocks) {
            var n, node, block;
            for (n = 0; n < blocks.length; n++) {
                block = blocks[n];
                if (node = this.findNode(this.root, block.w, block.h)){
                    block.fit = this.splitNode(node, block.w + this.mr, block.h + this.mt);
                }
            }
        },

        findNode: function(root, w, h) {
            if (root.used){
                return this.findNode(root.right, w, h) || this.findNode(root.down, w, h);
            }
            else if ((w <= root.w) && (h <= root.h)){
                return root;
            }
            else{
                return null;
            }
        },

        splitNode: function(node, w, h) {
            node.used = true;
            node.down = {
                x: node.x,
                y: node.y + h,
                w: node.w,
                h: node.h - h
            };
            node.right = {
                x: node.x + w,
                y: node.y,
                w: node.w - w,
                h: h
            };
            return node;
        }
    };

    var sort = {
        random: function(a, b) {
            return Math.random() - 0.5;
        },
        w: function(a, b) {
            return b.w - a.w;
        },
        h: function(a, b) {
            return b.h - a.h;
        },
        a: function(a, b) {
            return b.area - a.area;
        },
        max: function(a, b) {
            return Math.max(b.w, b.h) - Math.max(a.w, a.h);
        },
        min: function(a, b) {
            return Math.min(b.w, b.h) - Math.min(a.w, a.h);
        },

        height: function(a, b) {
            return sort.msort(a, b, ['h', 'w']);
        },
        width: function(a, b) {
            return sort.msort(a, b, ['w', 'h']);
        },
        area: function(a, b) {
            return sort.msort(a, b, ['a', 'h', 'w']);
        },
        maxside: function(a, b) {
            return sort.msort(a, b, ['max', 'min', 'h', 'w']);
        },

        msort: function(a, b, criteria) {
            var diff, n;
            for (n = 0; n < criteria.length; n++) {
                diff = sort[criteria[n]](a, b);
                if (diff != 0)
                    return diff;
            }
            return 0;
        }
    };

    var blocks = (function(){
    	var ret = [], items = document.querySelectorAll("#box li"), l = items.length, n, item;
    	for(n = 0; n < l; n++){
    		item = items[n];
    		ret.push({
    			w : item.offsetWidth,
    			h : item.offsetHeight,
    			node : item
    		});
    	}
    	return ret;
    })();

    var packer = new Packer(300, 300, 5, 5);
    blocks.sort(sort["area"]);
    packer.fit(blocks);

    for (var n = 0; n < blocks.length; n++) {
        var block = blocks[n];
        if (block.fit) {
        	block.node.style.cssText = ";position:absolute;left:" + block.fit.x + "px;top:" + block.fit.y + "px;";
        }
    }
    </script>

</body>

</html>
